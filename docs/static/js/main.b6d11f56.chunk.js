(this.webpackJsonpmap=this.webpackJsonpmap||[]).push([[0],{134:function(e,t){},181:function(e,t){},185:function(e,t,n){},186:function(e,t,n){"use strict";n.r(t);var r=n(23),a=n(3),c=n(86),o=n.n(c),u=n(49),i=n.n(u),s=n(124),l=n(75),d=n(82),b=function(e,t){return{type:"SET_STORED_DATA",payload:{data:e,name:t}}},p=function(e){return{type:"SET_CURRENT_DATA",payload:{data:e}}},f=function(e,t){return{type:"SET_COLUMN_NAMES",payload:{data:e,name:t}}},j=function(e){return{type:"SET_CURR_DATE",payload:{date:e}}},h=function(e){return{type:"SET_DATE_INDEX",payload:{index:e}}},O=function(e,t){return{type:"SET_BINS",payload:{bins:e,breaks:t}}},g=n(30),y=n(149),_=n(150);window.Module;function v(e){return Number(e)===e&&e%1===0}var w=function(){function e(){Object(y.a)(this,e),this.geojson_maps={}}return Object(_.a)(e,[{key:"ReadGeojsonMap",value:function(e,t){var n=new Uint8Array(t.result),r=window.Module._malloc(n.length);window.Module.HEAPU8.set(n,r),window.Module.ccall("new_geojsonmap1",null,["string","number","number"],[e,r,n.length]),window.Module._free(r);var a=window.Module.get_map_type(e);return this.geojson_maps[e]=a,e}},{key:"Has",value:function(e){return e in this.geojson_maps}},{key:"List",value:function(){return this.geojson_maps}},{key:"GetCentroids",value:function(e){for(var t=window.Module.get_centroids(e),n=t.get_x(),r=t.get_y(),a=[],c=0;c<n.size();++c)a.push([n.get(c),r.get(c)]);return a}},{key:"GetNumObs",value:function(e){return window.Module.get_num_obs(e)}},{key:"GetMapType",value:function(e){return this.geojson_maps[e]}},{key:"GetNumericCol",value:function(e,t){return window.Module.get_numeric_col(e,t)}},{key:"CreateRookWeights",value:function(e,t,n,r){return window.Module.rook_weights(e,t,n,r)}},{key:"CreateQueenWeights",value:function(e,t,n,r){return window.Module.queen_weights(e,t,n,r)}},{key:"GetMinDistThreshold",value:function(e,t,n){return window.Module.min_distance_threshold(e,t,n)}},{key:"CreateKnnWeights",value:function(e,t,n,r,a,c){return window.Module.knn_weights(e,t,n,r,a,c)}},{key:"CreateDistWeights",value:function(e,t,n,r,a,c){return window.Module.dist_weights(e,t,n,r,a,c)}},{key:"CreateKernelWeights",value:function(e,t,n,r,a,c,o){return window.Module.kernel_weights(e,t,n,r,a,c,o)}},{key:"CreateKernelBandwidthWeights",value:function(e,t,n,r,a,c){return window.Module.kernel_bandwidth_weights(e,t,n,r,a,c)}},{key:"local_moran",value:function(e,t,n){return window.Module.local_moran(e,t,n)}},{key:"local_moran1",value:function(e,t,n){return window.Module.local_moran1(e,t,this.toVecDouble(n))}},{key:"local_g",value:function(e,t,n){return window.Module.local_g(e,t,n)}},{key:"local_gstar",value:function(e,t,n){return window.Module.local_gstar(e,t,n)}},{key:"local_geary",value:function(e,t,n){return window.Module.local_geary(e,t,n)}},{key:"local_joincount",value:function(e,t,n){return window.Module.local_joincount(e,t,n)}},{key:"GetNeighbors",value:function(e,t,n){var r=window.Module.get_neighbors(e,t,n);return this.parseVecInt(r)}},{key:"parseVecInt",value:function(e){for(var t=[],n=0;n<e.size();++n)t.push(e.get(n));return t}},{key:"parseVecVecInt",value:function(e){for(var t=[],n=0;n<e.size();++n){for(var r=[],a=e.get(n),c=0;c<a.size();++c)r.push(a.get(c));t.push(r)}return t}},{key:"parseVecDouble",value:function(e){for(var t=[],n=0;n<e.size();++n)t.push(e.get(n));return t}},{key:"toVecString",value:function(e){for(var t=new window.Module.VectorString,n=0;n<e.length;++n)t.push_back(e[n]);return t}},{key:"toVecDouble",value:function(e){for(var t=new window.Module.VectorDouble,n=0;n<e.length;++n)isNaN(e[n])||e[n]==1/0?t.push_back(0):t.push_back(e[n]);return t}},{key:"redcap",value:function(e,t,n,r,a,c,o){var u=this.toVecString(r),i=window.Module.redcap(e,t,n,u,a,c,o);return this.parseVecVecInt(i)}},{key:"maxp",value:function(e,t,n,r,a,c,o,u,i,s){var l=this.toVecString(r),d=window.Module.maxp(e,t,l,a,c,u,i,o,n,s);return this.parseVecVecInt(d)}},{key:"custom_breaks",value:function(e,t,n,r,a){var c;c=null==r?window.Module.custom_breaks1(e,n,t,this.toVecDouble(a)):window.Module.custom_breaks(e,n,r,t);for(var o=this.parseVecDouble(c),u=o,i=[],s=[],l=0;l<o.length;++l){s.push([]);var d=v(o[l])?o[l]:o[l].toFixed(2);i.push(""+d)}s.push([]);var b=o[o.length-1];void 0!=b&&(b=v(b)?b:b.toFixed(2),i.push(">"+b)),o.unshift(Number.NEGATIVE_INFINITY),o.push(Number.POSITIVE_INFINITY);for(var p=0;p<a.length;++p)for(var f=a[p],j=0;j<o.length-1;++j){var h=o[j],O=o[j+1];if(f>=h&&f<O){s[j].push(p);break}}for(var g=0;g<i.length;++g);return{k:n,bins:i,breaks:u,id_array:s}}},{key:"cartogram",value:function(e,t){for(var n=window.Module.cartogram(e,this.toVecDouble(t)),r=n.get_x(),a=n.get_y(),c=n.get_radius(),o=r.get(0),u=r.get(0),i=a.get(0),s=a.get(0),l=0;l<r.size();++l)o>r.get(l)&&(o=r.get(l)),u<r.get(l)&&(u=r.get(l)),i>a.get(l)&&(i=a.get(l)),s<a.get(l)&&(s=a.get(l));for(var d=100/(u-o),b=45/(s-i),p=[],f=0;f<r.size();++f){r.get(f),a.get(f);p.push({properties:{id:f},position:[r.get(f)/1e4,a.get(f)/1e4],radius:c.get(f)})}return p}}]),e}(),m=function(){var e=Object(l.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:a=e.sent,r.ReadGeojsonMap("/geojson/county_usfacts.geojson".split("/").slice(-1)[0],{result:a});case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function x(){return(x=Object(l.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).then((function(e){var r=e.clone();return m(r,t,n),e.json()})).then((function(e){return e}));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(e,t){return x.apply(this,arguments)},k=n(222),E=n(210);function T(){return(T=Object(l.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).then((function(e){return e.ok?e.text():Promise.reject(e.status)})).then((function(e){for(var t=k.a(e,E.a),r={},a=t.length;a>0;)r[t[--a][n]]=Object.values(t[a]);return[r,Object.keys(t[0])]}));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=function(e,t){return T.apply(this,arguments)},I=n(151),N=function(e,t,n,r,a){var c={},o={},u=Object.keys(e.features[0]).length,i=e.features.length,s=parseInt(e.features[0].properties[t]);if(Number.isInteger(s))for(;i>0;)i--,c[parseInt(e.features[i].properties[t])]=e.features[i],o[parseInt(e.features[i].properties[t])]={};else for(;i>0;)i--,c[e.features[i].properties[t]]=e.features[i],o[e.features[i].properties[t]]={};for(var l=n.length;l>0;){l--;var d=Object.keys(n[l][0]);for(i=d.length;i>0;){i--;try{o[d[i]][r[l]]=n[l][0][d[i]]}catch(h){}}}for(var b=Object(I.merge)(c,o),p=[],f=Object.keys(b),j=0;j<f.length;j++)Object.keys(b[f[j]]).length==r.length+u&&p.push(b[f[j]]);return p},M=function(e,t,n){return e[t].indexOf(n)},A=function(e,t,n,r,a,c,o,u){return(e[t]-(null!==n&&e[t-n]))/(n+(null===n))/((r[a][c]-(null!==o&&r[a][c-o]))/(o+(null===o))||r[a]||1)*u},C=function(e,t,n,r,a,c,o,u,i){for(var s=performance.now(),l=[],d=e.length;d>0;)d--,l.push(A(e[d][t],n,r,e[d][a],c,o,u,i));return console.log(performance.now()-s),l},R=function(e,t,n){if(0==e)return n[0];for(var r=1;r<t.length;r++)if(e<t[r])return n[r];return n[0]},V=n(215),P=n(221),G=n(153),F=n(157),z=n(216),U={latitude:35.850033,longitude:-105.6500523,zoom:3.5,pitch:0,bearing:0},B={CONTINENTS:"".concat(".","/geojson/world50m.json")},L=new P.a({id:"globe",controller:!1,resolution:1}),X=new G.a({repeat:!0}),W=function(){var e=Object(a.useState)(!1),t=Object(d.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),u=Object(d.a)(o,2),i=u[0],s=(u[1],Object(g.c)((function(e){return e.storedData}))),l=Object(g.c)((function(e){return e.currentData})),b=Object(g.c)((function(e){return e.currDateIndex})),p=Object(g.c)((function(e){return e.bins})),f=Object(g.c)((function(e){return e.colorScale})),j=Object(g.c)((function(e){return e.use3D})),h=Object(g.c)((function(e){return e.dataParams})),O=Object(g.b)(),y=[new z.a({id:"base continents",data:B.CONTINENTS,pickable:!1,stroked:!1,filled:!0,wireframe:!1,getFillColor:[30,30,30]}),new z.a({id:"choropleth",data:{type:"FeatureCollection",name:l,crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:s[l]?s[l]:[]},pickable:!0,stroked:!1,filled:!0,wireframe:!1,extruded:j,opacity:j?1:.5,getFillColor:function(e){return function(e,t){return t.hasOwnProperty("bins")?R(A(e[h.numerator],b,h.nRange,e[h.denominator],h.dProperty,h.dIndex,h.dRange,h.scale),t.breaks,f):[0,0,0]}(e,p)},getElevation:function(e){return function(e,t){return t.hasOwnProperty("bins")?1e3*A(e[h.numerator],b,h.nRange,e[h.denominator],h.dProperty,h.dIndex,h.dRange,h.scale):0}(e,p)},updateTriggers:{data:l,getFillColor:b,getElevation:b},onHover:function(e){return c(e)},onClick:function(e){return O({type:"SET_DATA_SIDEBAR",payload:{data:e.object}})},autoHighlight:!0})];return Object(r.jsx)("div",{id:"mapContainer",style:{position:"fixed",left:0,top:0,width:"100%",height:"100%"},children:Object(r.jsxs)(V.a,{initialViewState:U,controller:!0,layers:y,views:i?L:X,children:[Object(r.jsx)(F.a,{reuseMaps:!0,mapStyle:"mapbox://styles/lixun910/ckhkoo8ix29s119ruodgwfxec",preventStyleDiffing:!0,mapboxApiAccessToken:"pk.eyJ1IjoibGl4dW45MTAiLCJhIjoiY2locXMxcWFqMDAwenQ0bTFhaTZmbnRwaiJ9.VRNeNnyb96Eo-CorkJmIqg"}),n.object&&Object(r.jsxs)("div",{style:{position:"absolute",zIndex:1,pointerEvents:"none",left:n.x,top:n.y,background:"white",padding:"0 10px"},children:[Object(r.jsx)("h5",{children:"".concat(n.object.properties.NAME,",").concat(n.object.properties.state_name)}),"Cases: ".concat(n.object.cases.slice(-1)[0]),Object(r.jsx)("br",{}),"Deaths: ".concat(n.object.deaths.slice(-1)[0]),Object(r.jsx)("br",{}),"New Cases: ".concat(n.object.cases.slice(-1)[0]-n.object.cases.slice(-2,-1)[0]),Object(r.jsx)("br",{}),"New Deaths: ".concat(n.object.deaths.slice(-1)[0]-n.object.deaths.slice(-2,-1)[0]),Object(r.jsx)("br",{})]})]})})},J=n(213),H=n(218),K=Object(J.a)({root:{width:"50%",position:"fixed",left:"50%",bottom:"20px",transform:"translateX(-50%)",padding:"5px 20px",boxSizing:"border-box",background:"black",border:"1px solid white"}}),Y=function(){var e=K(),t=Object(g.b)(),n=Object(g.c)((function(e){return e.currentData})),c=Object(g.c)((function(e){return e.dates})),o=Object(g.c)((function(e){return e.currDate})),u=Object(g.c)((function(e){return e.currDateIndex})),i=Object(a.useState)(null),s=Object(d.a)(i,2),l=s[0],b=s[1];return void 0!==c[n]?Object(r.jsxs)("div",{className:e.root,children:[Object(r.jsx)("button",{id:"playPause",onClick:function(){return function(e,n,r){null===e?b(setInterval((function(e){return t({type:"INCREMENT_DATE",payload:{index:n}})}),r)):(clearInterval(e),b(null))}(l,1,100)},children:null===l?"play":"pause"}),Object(r.jsx)("h4",{style:{textAlign:"center",color:"white"},children:o}),Object(r.jsx)(H.a,{value:u,onChange:function(e,r){var a;a=r,t(j(c[n][a])),function(e){t(h(e))}(r)},"aria-labelledby":"continuous-slider",min:0,step:1,max:c[n].length-1})]}):Object(r.jsx)("div",{className:e.root})},q=function(e){return Object(r.jsxs)("div",{id:"legend",children:[Object(r.jsx)("h4",{children:void 0!==e.title&&e.title}),Object(r.jsx)("div",{id:"binBars",children:void 0!==e.colors&&e.colors.map((function(e){return Object(r.jsx)("div",{className:"bin color",style:{backgroundColor:"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")")}},"".concat(e[0]).concat(e[1]))}))}),Object(r.jsxs)("div",{id:"binLabels",style:{padding:"0 ".concat(void 0!==e.labels?100/e.labels.length/2-1:0,"%")},children:[Object(r.jsx)("div",{className:"bin label",children:"0"}),void 0!==e.labels&&function(e){if(void 0!==e)return e.slice(-1)[0]!==">".concat(e.slice(-2,-1)[0])||(e.splice(0,1,"<".concat(e[0])),e.splice(-2,1)),e}(e.labels).map((function(e){return Object(r.jsx)("div",{className:"bin label",children:e},e)}))]})]})};var Q=function(){var e=Object(g.c)((function(e){return e.storedData})),t=Object(g.c)((function(e){return e.currentData})),n=Object(g.c)((function(e){return e.cols})),c=(Object(g.c)((function(e){return e.currDate})),Object(g.c)((function(e){return e.currDateIndex}))),o=Object(g.c)((function(e){return e.dates})),u=Object(g.c)((function(e){return e.bins})),y=Object(g.c)((function(e){return e.binMode})),_=Object(g.c)((function(e){return e.colorScale})),v=Object(g.c)((function(e){return e.dataParams})),m=Object(a.useState)(null),x=Object(d.a)(m,2),k=x[0],E=x[1],T=Object(g.b)(),I=function(e){for(var t=0;t<e.length;t++)if(Date.parse(e[t]))return e.slice(t)},A=function(e,t){for(var n={},r=0;r<e.length;r++)n[t[r]]=e[r][1];return n};function R(){return(R=Object(l.a)(i.a.mark((function e(t,n,r,a,c){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.map((function(e){return S("".concat(".","/csv/").concat(e,".csv"),r[1]).then((function(e){return e}))})),Promise.all([D("".concat(".","/geojson/").concat(t),c)].concat(Object(s.a)(o))).then((function(e){T(b(N(e[0],r[0],e.slice(1),a,r[1]),t)),T(p(t)),T(f(A(e.slice(1),a),t))}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){null===k&&E(new w)}),[window.Module]),Object(a.useEffect)((function(){null!=k&&""==t&&function(e,t,n,r,a){R.apply(this,arguments)}("county_usfacts.geojson",["covid_confirmed_usafacts","covid_deaths_usafacts","berkeley_predictions","chr_health_context","chr_life","chr_health_factors"],["GEOID","FIPS"],["cases","deaths","predictions","chr_health_context","chr_life","chr_health_factors"],k)}),[k]),Object(a.useEffect)((function(){""!=t&&(o.hasOwnProperty(t)||(function(e,t){T({type:"SET_CENTROIDS",payload:{data:t.GetCentroids(e),name:e}})}(t,k),function(e,t,n){var r=I(e[t]);T(function(e,t){return{type:"SET_DATES",payload:{data:e,name:t}}}(r,n)),T(j(r.slice(-1)[0])),T(h(M(e,t,r.slice(-1)[0])))}(n[t],"cases",t)))}),[n]),Object(a.useEffect)((function(){if(""!=c)if("dynamic"==y){var n=k.custom_breaks(t,"natural_breaks",8,null,C(e[t],v.numerator,c,v.nRange,v.denominator,v.dProperty,v.dIndex,v.dRange,v.scale));T(O(n.bins,[-Math.pow(10,12)].concat(Object(s.a)(n.breaks.slice(1,-1)),[Math.pow(10,12)])))}else if(!u.hasOwnProperty("bins")){var r=k.custom_breaks(t,"natural_breaks",8,null,C(e[t],v.numerator,c,v.nRange,v.denominator,v.dProperty,v.dIndex,v.dRange,v.scale));T(O(r.bins,[-Math.pow(10,12)].concat(Object(s.a)(r.breaks.slice(1,-1)),[Math.pow(10,12)])))}}),[c]),Object(r.jsxs)("div",{className:"App",children:[Object(r.jsxs)("header",{className:"App-header",style:{position:"fixed",left:"20px",top:"20px",zIndex:10},children:[Object(r.jsx)("h1",{style:{color:"white"},children:"Tech Demo"}),Object(r.jsx)("button",{onClick:function(){return T({type:"SET_3D"})},children:"3D"})]}),Object(r.jsx)(W,{}),Object(r.jsx)(q,{labels:u.bins,title:t,colors:_}),Object(r.jsx)(Y,{})]})},Z=n(109),$=n(24),ee={geodaProxy:null,storedData:{},cols:{},currentData:"",chartData:{},bins:{},binMode:"",colorScale:[[240,240,240],[255,255,204],[255,237,160],[254,217,118],[254,178,76],[253,141,60],[252,78,42],[227,26,28],[177,0,38]],centroids:{},dates:{},currDate:"",currDateIndex:"",currentVariable:"7-Day Average Daily New Confirmed Count per 100K Pop",currentMethod:"natural_breaks",currentOverlay:"",currentResource:"",dataParams:{numerator:"cases",nRange:7,denominator:"properties",dProperty:"population",dRange:null,dIndex:null,scale:1e5},isCartogram:!1,currentGeoid:"",use3D:!1,sidebarData:{}},te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GEOID":return Object($.a)(Object($.a)({},e),{},{currentGeoid:t.payload.geoid});case"SET_STORED_DATA":var n=Object($.a)({},e.storedData);return n[t.payload.name]=t.payload.data,Object($.a)(Object($.a)({},e),{},{storedData:n});case"SET_CENTROIDS":var r=Object($.a)({},e.centroids);return r[t.payload.name]=t.payload.data,Object($.a)(Object($.a)({},e),{},{centroids:r});case"SET_CURRENT_DATA":return Object($.a)(Object($.a)({},e),{},{currentData:t.payload.data});case"SET_GEODA_PROXY":return Object($.a)(Object($.a)({},e),{},{geodaProxy:t.payload.proxy});case"SET_DATES":var a=Object($.a)({},e.dates);return a[t.payload.name]=t.payload.data,Object($.a)(Object($.a)({},e),{},{dates:a});case"SET_DATA_FUNCTION":return Object($.a)(Object($.a)({},e),{},{currentDataFn:t.payload.fn});case"SET_COLUMN_NAMES":var c=Object($.a)({},e.cols);return c[t.payload.name]=t.payload.data,Object($.a)(Object($.a)({},e),{},{cols:c});case"SET_CURR_DATE":return Object($.a)(Object($.a)({},e),{},{currDate:t.payload.date});case"SET_DATE_INDEX":return Object($.a)(Object($.a)({},e),{},{currDateIndex:t.payload.index});case"SET_BINS":var o={};return o.bins=t.payload.bins,o.breaks=t.payload.breaks,Object($.a)(Object($.a)({},e),{},{bins:o});case"SET_3D":return Object($.a)(Object($.a)({},e),{},{use3D:!e.use3D});case"SET_DATA_SIDEBAR":return Object($.a)(Object($.a)({},e),{},{sidebarData:t.payload.data});case"INCREMENT_DATE":return t.payload.index+e.currDateIndex>e.dates[e.currentData].length?Object($.a)(Object($.a)({},e),{},{currDateIndex:0}):Object($.a)(Object($.a)({},e),{},{currDateIndex:e.currDateIndex+t.payload.index,currDate:e.dates[e.currentData][e.currDateIndex+t.payload.index]});case"SET_VARIALBLE_PARAMS":var u=Object($.a)(Object($.a)({},e.dataParams),t.payload.params);return Object($.a)(Object($.a)({},e),{},{dataParams:u});default:return e}},ne=(n(185),Object(Z.b)(te,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));o.a.render(Object(r.jsx)(g.a,{store:ne,children:Object(r.jsx)(Q,{})}),document.getElementById("root"))}},[[186,1,2]]]);
//# sourceMappingURL=main.b6d11f56.chunk.js.map