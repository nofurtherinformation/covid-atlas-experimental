(this.webpackJsonpmap=this.webpackJsonpmap||[]).push([[0],{131:function(e,t){},177:function(e,t){},181:function(e,t,n){"use strict";n.r(t);var r=n(38),a=n(3),o=n(85),c=n.n(o),u=n(49),i=n.n(u),s=n(121),l=n(75),d=function(e,t){return{type:"SET_STORED_DATA",payload:{data:e,name:t}}},f=function(e){return{type:"SET_CURRENT_DATA",payload:{data:e}}},p=function(e,t){return{type:"SET_COLUMN_NAMES",payload:{data:e,name:t}}},b=function(e){return{type:"SET_CURR_DATE",payload:{date:e}}},h=function(e){return{type:"SET_DATE_INDEX",payload:{index:e}}},g=function(e,t){return{type:"SET_BINS",payload:{bins:e,breaks:t}}},j=n(28),y=n(146),_=n(147);window.Module;function O(e){return Number(e)===e&&e%1===0}var w=function(){function e(){Object(y.a)(this,e),this.geojson_maps={}}return Object(_.a)(e,[{key:"ReadGeojsonMap",value:function(e,t){var n=new Uint8Array(t.result),r=window.Module._malloc(n.length);window.Module.HEAPU8.set(n,r),window.Module.ccall("new_geojsonmap1",null,["string","number","number"],[e,r,n.length]),window.Module._free(r);var a=window.Module.get_map_type(e);return this.geojson_maps[e]=a,e}},{key:"Has",value:function(e){return e in this.geojson_maps}},{key:"List",value:function(){return this.geojson_maps}},{key:"GetCentroids",value:function(e){for(var t=window.Module.get_centroids(e),n=t.get_x(),r=t.get_y(),a=[],o=0;o<n.size();++o)a.push([n.get(o),r.get(o)]);return a}},{key:"GetNumObs",value:function(e){return window.Module.get_num_obs(e)}},{key:"GetMapType",value:function(e){return this.geojson_maps[e]}},{key:"GetNumericCol",value:function(e,t){return window.Module.get_numeric_col(e,t)}},{key:"CreateRookWeights",value:function(e,t,n,r){return window.Module.rook_weights(e,t,n,r)}},{key:"CreateQueenWeights",value:function(e,t,n,r){return window.Module.queen_weights(e,t,n,r)}},{key:"GetMinDistThreshold",value:function(e,t,n){return window.Module.min_distance_threshold(e,t,n)}},{key:"CreateKnnWeights",value:function(e,t,n,r,a,o){return window.Module.knn_weights(e,t,n,r,a,o)}},{key:"CreateDistWeights",value:function(e,t,n,r,a,o){return window.Module.dist_weights(e,t,n,r,a,o)}},{key:"CreateKernelWeights",value:function(e,t,n,r,a,o,c){return window.Module.kernel_weights(e,t,n,r,a,o,c)}},{key:"CreateKernelBandwidthWeights",value:function(e,t,n,r,a,o){return window.Module.kernel_bandwidth_weights(e,t,n,r,a,o)}},{key:"local_moran",value:function(e,t,n){return window.Module.local_moran(e,t,n)}},{key:"local_moran1",value:function(e,t,n){return window.Module.local_moran1(e,t,this.toVecDouble(n))}},{key:"local_g",value:function(e,t,n){return window.Module.local_g(e,t,n)}},{key:"local_gstar",value:function(e,t,n){return window.Module.local_gstar(e,t,n)}},{key:"local_geary",value:function(e,t,n){return window.Module.local_geary(e,t,n)}},{key:"local_joincount",value:function(e,t,n){return window.Module.local_joincount(e,t,n)}},{key:"GetNeighbors",value:function(e,t,n){var r=window.Module.get_neighbors(e,t,n);return this.parseVecInt(r)}},{key:"parseVecInt",value:function(e){for(var t=[],n=0;n<e.size();++n)t.push(e.get(n));return t}},{key:"parseVecVecInt",value:function(e){for(var t=[],n=0;n<e.size();++n){for(var r=[],a=e.get(n),o=0;o<a.size();++o)r.push(a.get(o));t.push(r)}return t}},{key:"parseVecDouble",value:function(e){for(var t=[],n=0;n<e.size();++n)t.push(e.get(n));return t}},{key:"toVecString",value:function(e){for(var t=new window.Module.VectorString,n=0;n<e.length;++n)t.push_back(e[n]);return t}},{key:"toVecDouble",value:function(e){for(var t=new window.Module.VectorDouble,n=0;n<e.length;++n)isNaN(e[n])||e[n]==1/0?t.push_back(0):t.push_back(e[n]);return t}},{key:"redcap",value:function(e,t,n,r,a,o,c){var u=this.toVecString(r),i=window.Module.redcap(e,t,n,u,a,o,c);return this.parseVecVecInt(i)}},{key:"maxp",value:function(e,t,n,r,a,o,c,u,i,s){var l=this.toVecString(r),d=window.Module.maxp(e,t,l,a,o,u,i,c,n,s);return this.parseVecVecInt(d)}},{key:"custom_breaks",value:function(e,t,n,r,a){var o;o=null==r?window.Module.custom_breaks1(e,n,t,this.toVecDouble(a)):window.Module.custom_breaks(e,n,r,t);for(var c=this.parseVecDouble(o),u=c,i=[],s=[],l=0;l<c.length;++l){s.push([]);var d=O(c[l])?c[l]:c[l].toFixed(2);i.push(""+d)}s.push([]);var f=c[c.length-1];void 0!=f&&(f=O(f)?f:f.toFixed(2),i.push(">"+f)),c.unshift(Number.NEGATIVE_INFINITY),c.push(Number.POSITIVE_INFINITY);for(var p=0;p<a.length;++p)for(var b=a[p],h=0;h<c.length-1;++h){var g=c[h],j=c[h+1];if(b>=g&&b<j){s[h].push(p);break}}for(var y=0;y<i.length;++y);return{k:n,bins:i,breaks:u,id_array:s}}},{key:"cartogram",value:function(e,t){for(var n=window.Module.cartogram(e,this.toVecDouble(t)),r=n.get_x(),a=n.get_y(),o=n.get_radius(),c=r.get(0),u=r.get(0),i=a.get(0),s=a.get(0),l=0;l<r.size();++l)c>r.get(l)&&(c=r.get(l)),u<r.get(l)&&(u=r.get(l)),i>a.get(l)&&(i=a.get(l)),s<a.get(l)&&(s=a.get(l));for(var d=100/(u-c),f=45/(s-i),p=[],b=0;b<r.size();++b){r.get(b),a.get(b);p.push({properties:{id:b},position:[r.get(b)/1e4,a.get(b)/1e4],radius:o.get(b)})}return p}}]),e}(),v=function(){var e=Object(l.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:a=e.sent,r.ReadGeojsonMap("/geojson/county_usfacts.geojson".split("/").slice(-1)[0],{result:a});case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function k(){return(k=Object(l.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).then((function(e){var r=e.clone();return v(r,t,n),e.json()})).then((function(e){return e}));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=function(e,t){return k.apply(this,arguments)},D=n(217),x=n(205);function E(){return(E=Object(l.a)(i.a.mark((function e(t,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).then((function(e){return e.ok?e.text():Promise.reject(e.status)})).then((function(e){for(var t=D.a(e,x.a),r={},a=t.length;a>0;)r[t[--a][n]]=Object.values(t[a]);return[r,Object.keys(t[0])]}));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=function(e,t){return E.apply(this,arguments)},M=n(148),S=function(e,t,n,r,a){var o={},c={},u=Object.keys(e.features[0]).length,i=e.features.length,s=parseInt(e.features[0].properties[t]);if(Number.isInteger(s))for(;i>0;)i--,o[parseInt(e.features[i].properties[t])]=e.features[i],c[parseInt(e.features[i].properties[t])]={};else for(;i>0;)i--,o[e.features[i].properties[t]]=e.features[i],c[e.features[i].properties[t]]={};for(var l=n.length;l>0;){l--;var d=Object.keys(n[l][0]);for(i=d.length;i>0;){i--;try{c[d[i]][r[l]]=n[l][0][d[i]]}catch(g){}}}for(var f=Object(M.merge)(o,c),p=[],b=Object.keys(f),h=0;h<b.length;h++)Object.keys(f[b[h]]).length==r.length+u&&p.push(f[b[h]]);return p},I=function(e,t,n){return e[t].indexOf(n)},N=function(e,t,n,r,a){for(var o=performance.now(),c=[],u=t.length;u>0;)u--,c.push(e(t[u],n,r,a));return console.log(performance.now()-o),c},A=n(210),C=n(216),V=n(153),R=n(211),G={latitude:35.850033,longitude:-105.6500523,zoom:3.5,pitch:0,bearing:0},F=(new C.a({id:"globe",controller:!1,resolution:1}),function(){var e=Object(j.c)((function(e){return e.storedData})),t=Object(j.c)((function(e){return e.currentData})),n=Object(j.c)((function(e){return e.currDateIndex})),a=Object(j.c)((function(e){return e.bins})),o=Object(j.c)((function(e){return e.colorScale})),c=Object(j.c)((function(e){return e.currentDataFn})),u=Object(j.c)((function(e){return e.currentMapFn})),i=Object(j.c)((function(e){return e.use3D})),s=new R.a({id:"polygon-layer",data:{type:"FeatureCollection",name:t,crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:e[t]?e[t]:[]},pickable:!0,stroked:!1,filled:!0,wireframe:!1,extruded:i,getFillColor:function(e){return function(e,t){return t.hasOwnProperty("bins")?u(c(e,"cases",n,7),t.breaks,o):[0,0,0]}(e,a)},getElevation:function(e){return function(e,t){return t.hasOwnProperty("bins")?1e3*c(e,"cases",n,7):0}(e,a)},updateTriggers:{data:t,getFillColor:n,getElevation:n}});return Object(r.jsx)("div",{id:"mapContainer",style:{position:"fixed",left:0,top:0,width:"100%",height:"100%"},children:Object(r.jsx)(A.a,{initialViewState:G,controller:!0,layers:s,children:Object(r.jsx)(V.a,{reuseMaps:!0,mapStyle:"mapbox://styles/lixun910/ckg8gz59r5kz119pe0yfx0lwb",preventStyleDiffing:!0,mapboxApiAccessToken:"pk.eyJ1IjoibGl4dW45MTAiLCJhIjoiY2locXMxcWFqMDAwenQ0bTFhaTZmbnRwaiJ9.VRNeNnyb96Eo-CorkJmIqg"})})})}),P=n(208),z=n(213),U=Object(P.a)({root:{width:"50%",position:"fixed",left:"50%",bottom:"20px",transform:"translateX(-50%)",padding:"5px 20px",boxSizing:"border-box",background:"black",border:"1px solid white"}}),X=function(){var e=U(),t=Object(j.b)(),n=Object(j.c)((function(e){return e.currentData})),a=Object(j.c)((function(e){return e.dates})),o=Object(j.c)((function(e){return e.currDate})),c=Object(j.c)((function(e){return e.currDateIndex}));return void 0!==a[n]?Object(r.jsxs)("div",{className:e.root,children:[Object(r.jsx)("h4",{style:{textAlign:"center",color:"white"},children:o}),Object(r.jsx)(z.a,{value:c,onChange:function(e,r){var o;o=r,t(b(a[n][o])),function(e){t(h(e))}(r)},"aria-labelledby":"continuous-slider",min:0,step:1,max:a[n].length-1})]}):Object(r.jsx)("div",{className:e.root})};var W=function(){var e=Object(j.c)((function(e){return e.storedData})),t=Object(j.c)((function(e){return e.currentData})),n=Object(j.c)((function(e){return e.geodaProxy})),o=Object(j.c)((function(e){return e.currentDataFn})),c=Object(j.c)((function(e){return e.cols})),u=(Object(j.c)((function(e){return e.currDate})),Object(j.c)((function(e){return e.currDateIndex}))),y=Object(j.c)((function(e){return e.dates})),_=Object(j.c)((function(e){return e.bins})),O=Object(j.c)((function(e){return e.binMode})),v=Object(j.b)(),k=function(e){for(var t=0;t<e.length;t++)if(Date.parse(e[t]))return e.slice(t)},D=function(e,t){for(var n={},r=0;r<e.length;r++)n[t[r]]=e[r][1];return n};function x(){return(x=Object(l.a)(i.a.mark((function e(t,r,a,o){var c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=r.map((function(e){return T("".concat("","/csv/").concat(e,".csv"),a[1]).then((function(e){return e}))})),Promise.all([m("".concat("","/geojson/").concat(t),n)].concat(Object(s.a)(c))).then((function(e){v(d(S(e[0],a[0],e.slice(1),o,a[1]),t)),v(f(t)),v(p(D(e.slice(1),o),t))}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){null===n&&v({type:"SET_GEODA_PROXY",payload:{proxy:new w}})}),[window.Module]),Object(a.useEffect)((function(){null!=n&&""==t&&function(e,t,n,r){x.apply(this,arguments)}("county_usfacts.geojson",["covid_confirmed_usafacts","covid_deaths_usafacts","berkeley_predictions","chr_health_context","chr_life","chr_health_factors"],["GEOID","FIPS"],["cases","deaths","predictions","chr_health_context","chr_life","chr_health_factors"])}),[n]),Object(a.useEffect)((function(){""!=t&&(y.hasOwnProperty(t)||(function(e,t){v({type:"SET_CENTROIDS",payload:{data:t.GetCentroids(e),name:e}})}(t,n),function(e,t,n){var r=k(e[t]);v(function(e,t){return{type:"SET_DATES",payload:{data:e,name:t}}}(r,n)),v(b(r.slice(-1)[0])),v(h(I(e,t,r.slice(-1)[0])))}(c[t],"cases",t)))}),[c]),Object(a.useEffect)((function(){if(""!=u)if("dynamic"==O){var r=n.custom_breaks(t,"natural_breaks",8,null,N(o,e[t],"cases",u,7));v(g(r.bins,[-Math.pow(10,12)].concat(Object(s.a)(r.breaks.slice(1,-1)),[Math.pow(10,12)])))}else if(!_.hasOwnProperty("bins")){var a=n.custom_breaks(t,"natural_breaks",8,null,N(o,e[t],"cases",u,7));v(g(a.bins,[-Math.pow(10,12)].concat(Object(s.a)(a.breaks.slice(1,-1)),[Math.pow(10,12)])))}}),[u]),Object(r.jsxs)("div",{className:"App",children:[Object(r.jsxs)("header",{className:"App-header",style:{position:"fixed",left:"20px",top:"20px",zIndex:10},children:[Object(r.jsx)("h1",{style:{color:"white"},children:"Tech Demo"}),Object(r.jsx)("button",{onClick:function(){return v({type:"SET_3D"})},children:"3D"})]}),Object(r.jsx)(F,{}),Object(r.jsx)(X,{})]})},J=n(106),L=n(29),B={geodaProxy:null,storedData:{},cols:{},currentData:"",chartData:{},bins:{},binMode:"",colorScale:[[255,255,204],[255,237,160],[254,217,118],[254,178,76],[253,141,60],[252,78,42],[227,26,28],[177,0,38]],centroids:{},dates:{},currDate:"",currDateIndex:"",currentVariable:"7-Day Average Daily New Confirmed Count per 100K Pop",currentMethod:"natural_breaks",currentOverlay:"",currentResource:"",isCartogram:!1,currentGeoid:"",use3D:!1,currentDataFn:function(e,t,n,r){return(e[t][n]-e[t][n-r])/7/e.properties.population*1e5},currentMapFn:function(e,t,n){for(var r=0;r<t.length;r++)if(e<t[r])return n[r];return[0,0,0]}},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GEOID":return Object(L.a)(Object(L.a)({},e),{},{currentGeoid:t.payload.geoid});case"SET_STORED_DATA":var n=Object(L.a)({},e.storedData);return n[t.payload.name]=t.payload.data,Object(L.a)(Object(L.a)({},e),{},{storedData:n});case"SET_CENTROIDS":var r=Object(L.a)({},e.centroids);return r[t.payload.name]=t.payload.data,Object(L.a)(Object(L.a)({},e),{},{centroids:r});case"SET_CURRENT_DATA":return Object(L.a)(Object(L.a)({},e),{},{currentData:t.payload.data});case"SET_GEODA_PROXY":return Object(L.a)(Object(L.a)({},e),{},{geodaProxy:t.payload.proxy});case"SET_DATES":var a=Object(L.a)({},e.dates);return a[t.payload.name]=t.payload.data,Object(L.a)(Object(L.a)({},e),{},{dates:a});case"SET_DATA_FUNCTION":return Object(L.a)(Object(L.a)({},e),{},{currentDataFn:t.payload.fn});case"SET_COLUMN_NAMES":var o=Object(L.a)({},e.cols);return o[t.payload.name]=t.payload.data,Object(L.a)(Object(L.a)({},e),{},{cols:o});case"SET_CURR_DATE":return Object(L.a)(Object(L.a)({},e),{},{currDate:t.payload.date});case"SET_DATE_INDEX":return Object(L.a)(Object(L.a)({},e),{},{currDateIndex:t.payload.index});case"SET_BINS":var c={};return c.bins=t.payload.bins,c.breaks=t.payload.breaks,Object(L.a)(Object(L.a)({},e),{},{bins:c});case"SET_3D":return Object(L.a)(Object(L.a)({},e),{},{use3D:!e.use3D});default:return e}},K=Object(J.b)(Y,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());c.a.render(Object(r.jsx)(j.a,{store:K,children:Object(r.jsx)(W,{})}),document.getElementById("root"))}},[[181,1,2]]]);
//# sourceMappingURL=main.75a5c8a8.chunk.js.map